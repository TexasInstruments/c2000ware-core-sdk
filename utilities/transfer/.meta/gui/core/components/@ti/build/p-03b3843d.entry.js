import{r as t,c as e,h as o,g as i}from"./p-823ca21f.js";import{W as r}from"./p-b29896ef.js";import{GcConsole as n}from"../gc-core-assets/lib/GcConsole";import{GcLocalStorage as s}from"../gc-core-assets/lib/GcLocalStorage";import"../gc-core-assets/lib/GcUtils";import"../gc-core-assets/lib/GcFiles";import"../gc-widget-message-dialog/lib/GcMessageDialog";const a=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}:host div.message{padding:5px 10px;margin:5px;white-space:normal}:host div.message .title-container{display:flex}:host div.message .spacer{flex:1;min-width:30px}:host div.message .title{font-size:var(--gc-sub-header-font-size, var(--theme-sub-header-font-size, 14px));font-weight:var(--gc-sub-header-font-weight, var(--theme-sub-header-font-weight, 200));text-transform:capitalize;border-radius:3px;padding:2px 5px;margin-left:-5px;color:#ffffff;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}:host div.message .title.error{background-color:#cc0000}:host div.message .title.warning{background-color:#f4b821}:host div.message .title.info{background-color:#98999b}:host div.message .dismiss{align-self:center;cursor:pointer;font-size:small;float:right;white-space:nowrap;margin-left:5px;color:var(--gc-link-color, var(--theme-link-color, #333333))}:host div.message .dismiss:hover{text-decoration:underline}:host div.message .content{margin-top:5px}:host div.message:not(:last-child){border-bottom:2px solid var(--gc-border-color, var(--theme-border-color, #e5e5e5))}:host{margin:0}:host #announcement_container{position:fixed;max-height:140px;background-color:#ffffe5;box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.14);color:#555555;overflow:auto}';const c=new n("gc-widget-announcement");const l="dismissedAnnouncements";let h=class{constructor(o){t(this,o);this.announcementAdded=e(this,"announcement-added",7);this.announcementRemoved=e(this,"announcement-removed",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.announcements=[];this.source="/announcements";this.updateInterval=-1;this.fetchAnnouncements=async()=>{try{const t=await(await fetch(this.source)).json();this.clearAnnouncements();t.forEach((t=>this.addAnnouncement(t)));const e=JSON.parse(s.getItem(l)||"{}");const o=t.map((t=>this.getMessageHash(t)));for(const t of Object.keys(e)){if(o.indexOf(+t)===-1){delete e[t]}}s.setItem(l,JSON.stringify(e,null,4))}catch(t){c.error(t)}};this.updateAnnouncementPosition=()=>{if(this.announcementContainerEl){const t=this.parentContainer??document.body;if(t){const e=t.getBoundingClientRect();this.announcementContainerEl.style.top=`${e.top}px`;this.announcementContainerEl.style.left=`${e.left}px`;this.announcementContainerEl.style.width=`${e.width}px`}}};this._refresh=0;this.hidden=false}render(){const t=JSON.parse(s.getItem(l)||"{}");return r.doRender(o("div",{id:"announcement_container",ref:t=>this.announcementContainerEl=t},this.announcements.map((e=>{const i=this.getMessageHash(e);if(t[i]){return undefined}return o("div",{part:"announcement-message",class:"message"},o("div",{class:"title-container"},o("div",{class:`title ${e.type}`},e.title),o("div",{class:"spacer"}),o("div",{class:"dismiss",onClick:()=>this.onDismissAnnouncementClick(e)},"(dismiss)")),o("div",{class:"content",innerHTML:e.message}))}))))}componentDidLoad(){window.addEventListener("resize",(()=>this.updateAnnouncementPosition()),true);window.addEventListener("scroll",(()=>this.updateAnnouncementPosition()),true);if(this.updateInterval>=0){this.fetchAnnouncements()}if(this.updateInterval>=10){setInterval((()=>this.fetchAnnouncements()),this.updateInterval*6e4)}}componentDidRender(){this.updateAnnouncementPosition()}async setParentContainer(t){this.parentContainer=t;this.updateAnnouncementPosition()}async addAnnouncement(t){const e=this.getMessageHash(t);this.announcements=[Object.assign(t,{handler:e}),...this.announcements];this.announcementAdded.emit({handler:e});return e}async removeAnnouncement(t){const e=this.announcements.filter((e=>e.handler!==t));if(e.length<this.announcements.length){this.announcements=e;this.announcementRemoved.emit({handler:t})}}async clearAnnouncements(){this.announcements.reverse().forEach((t=>this.removeAnnouncement(t.handler)))}async getAnnouncementClientRect(){return new Promise((t=>{window.requestAnimationFrame((()=>{if(this.announcementContainerEl){t(this.announcementContainerEl.getBoundingClientRect())}else{t(undefined)}}))}))}getMessageHash(t){let e=0;const o=t.message+t.title+t.type;if(o.length===0){return e}for(let t=0;t<o.length;t++){const i=o.charCodeAt(t);e=(e<<5)-e+i;e|=0}return e}onDismissAnnouncementClick(t){c.debug(`Dismiss announcement message clicked handler=${t.handler}`);this.removeAnnouncement(t.handler);const e=this.getMessageHash(t);const o=JSON.parse(s.getItem(l)||"{}");o[e]=true;s.setItem(l,JSON.stringify(o,null,4))}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return i(this)}};h.style=a;export{h as gc_widget_announcement};
//# sourceMappingURL=p-03b3843d.entry.js.map