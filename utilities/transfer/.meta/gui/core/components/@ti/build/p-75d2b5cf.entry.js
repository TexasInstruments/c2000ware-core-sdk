import{r as t,c as e,h as i,g as r}from"./p-823ca21f.js";import{GcUtils as s}from"../gc-core-assets/lib/GcUtils";import{DataConverter as o,valueChangedEventType as n,bindingRegistry as a,ProgressCounter as h}from"../gc-core-databind/lib/CoreDatabind";import{codecRegistry as c}from"../gc-target-configuration/lib/TargetConfiguration";import{W as l}from"./p-9042acad.js";import{GcPromise as d}from"../gc-core-assets/lib/GcPromise";import{GcMessageDialog as g}from"../gc-widget-message-dialog/lib/GcMessageDialog";import"./p-b29896ef.js";import"../gc-core-assets/lib/GcFiles";import"../gc-core-assets/lib/GcConsole";import"../gc-core-assets/lib/GcLocalStorage";const f=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}.container,.info-container:not([hidden]){display:flex;flex-direction:column;width:100%}.container{height:100%;box-sizing:border-box}.heading{font-size:var(--gc-header-font-size, var(--theme-header-font-size, 21px));font-weight:var(--gc-header-font-weight, var(--theme-header-font-weight, 500));position:relative}.heading:before{content:"";position:absolute;width:calc(100% - 10px);height:1px;bottom:2px;border-bottom:2px solid var(--theme-primary-color, #cc0000)}.sub-heading{font-size:var(--gc-sub-header-font-size, var(--theme-sub-header-font-size, 14px))}.info-title,.sub-heading{color:var(--theme-secondary-color, #118899);font-weight:bold}.info-container>div.info-title{margin-bottom:4px;margin-top:10px}.info-container,.info-container gc-widget-label{user-select:text}.heading,.sub-heading,.scroll-container{padding:5px;}.scroll-container{overflow:auto}.field-container *,.info-container *{margin:0px}.field-container{align-items:center;padding-top:5px}.field-container:not(:nth-last-child(2)){border-bottom:1px solid var(--gc-border-color, var(--theme-border-color, #e5e5e5));padding-bottom:5px}.header-container,.widget-container{display:flex;flex-direction:row;align-items:center}.header-container>*:not(:last-child),.widget-container>*:not(:last-child){margin-right:5px}.header-container{margin-bottom:4px}.header-container gc-widget-icon{--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b));cursor:pointer}.header-container div.caption{color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400))}.widget-container{min-height:34px;}.widget-container gc-widget-led:focus{outline:1px dotted var(--gc-focus-color, var(--gc-font-color, var(--theme-font-color, #555555)));outline-offset:-1px}.flex{flex-grow:1;flex-shrink:1}.right-align{--gc-text-align:right}';let u=class{constructor(i){t(this,i);this.valueChanged=e(this,"value-changed",7);this.selectedFieldIndexChanged=e(this,"selected-field-index-changed",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.keyCounters=new Map;this.isRendering=false;this.onRegisterValueChangedListener=()=>{this.value=this.registerValueBind?.getValue()??this.registerInfo.default};this.onRegisterSymbolsChangedListener=()=>{this.registerInfo=this.registerModel?.getRegisterInfo(this.registerName);this.selectedFieldIndex=-1};this.onIndicatorToggle=t=>{const e=+t.currentTarget.id;const i=this.registerInfo?.fields?.[e];if(i&&!this.isReadOnly(i)){this.setBitFieldValue(i,this.getBitFieldValue(i)?0:1)}};this.onIndicatorKeyHandler=t=>{if(t.key===" "&&!t.shiftKey&&!t.ctrlKey){this.onIndicatorToggle(t);t.preventDefault();t.stopPropagation()}};this.toggleHelp=t=>{if(this.selectedFieldIndex<0){this.selectedFieldIndex=+t.currentTarget.id}else{this.selectedFieldIndex=-1}};this.onWidgetValueChanged=t=>{const e=+t.currentTarget.id;const i=this.registerInfo?.fields?.[e];if(i){this.setBitFieldValue(i,+t.detail.value)}};this.selectedFieldIndex=-1;this.value=0;this._refresh=0;this.hidden=false}getBitFieldType(t){if(t.attrs?.isLocked||this.registerInfo?.attrs?.readonly){return"R"}if(this.registerInfo?.attrs?.writeonly){return"W"}return"RW"}isReadOnly(t){return this.getBitFieldType(t)==="R"}getBitFieldRange(t,e=":"){if(t===undefined){return""}if(t.stop>t.start){return`${t.stop}${e}${t.start}`}if(t.stop===t.start){return`${t.stop}`}return""}getSelectValues(t){if(t.options){return`${t.options.map((t=>t.value)).join("|")}|`}const e=t.stop-t.start+1;const i=1<<e;return`${new Array(i).fill("").map(((t,e)=>`${e}`)).join("|")}|`}getSelectLabels(t){if(t.options){return`${t.options.map((t=>t.display)).join("|")}|`}const e=t.stop-t.start+1;const i=1<<e;return`${new Array(i).fill("").map(((t,i)=>`b${o.convert(i,"number","binary",e)}`)).join("|")}|`}isDecimalFormat(t){return t.widget&&(t.widget.format==="dec"||t.widget.format==="exp"||!t.widget.format&&t.widget.type==="spinner")}getBitFieldValue(t){if(this.isDecimalFormat(t)){return this.registerModel.getBinding(`${this.registerName}.${this.getSymbolName(t)}`).getValue()}const e=s.bitField.getMask(t.start,t.stop);return s.bitField.readField(this.value,e,t.start)}setBitFieldValue(t,e){if(this.isRendering){return}if(this.isDecimalFormat(t)){this.registerModel.getBinding(`${this.registerName}.${this.getSymbolName(t)}`).setValue(e)}else{const i=s.bitField.getMask(t.start,t.stop);this.value=s.bitField.writeField(this.value,i,t.start,e)}}getFormat(t){return t.widget?.format??(t.widget?.type==="spinner"?"dec":"hex")}getPrecision(t){if(t.widget?.type==="spinner"&&!t.widget.format){let e=0;const i=t.widget.step?.toString()??"";if(i.includes(".")){e=i.length-i.indexOf(".")-1}return e}return t.widget?.format?t.widget.precision:Math.ceil((t.stop-t.start+1)/4)}getReadOnlyDisplayValue(t,e){if(t.options&&t.options.length>e){return t.options[e].display}const i=t.stop-t.start+1;let r;let s;if(t.widget?.format){r=t.widget.format;s=t.widget.precision}else{r=i<8?"binary":"hex";s=i<8?i:Math.ceil(i/4)}const n=o.convert(e,"number",r,s);return r==="binary"?"b"+n:n}getSymbolName(t){return t.id||t.name}getRegisterDisplayName(){return this.registerInfo?`${this.registerInfo.groupName?`${this.registerInfo.groupName} / `:""}${this.registerInfo.name}`:""}getBifFieldWidgetType(t){const e=this.isReadOnly(t);const i=t.widget?.type!==undefined&&t.widget.type!=="value";if(e&&!i){return"label"}if(t.widget?.type){return t.widget.type}if(t.options){return"select"}if(t.stop===t.start){return"checkbox"}if(t.stop<=t.start+3){return"select"}return"value"}generateKey(t){let e=this.keyCounters.get(t);if(e===undefined){e={count:0,total:0};this.keyCounters.set(t,e)}e.count++;if(e.count>e.total){e.total=e.count}return`${t}${e.count}`}renderBitFieldWidget(t,e,r=undefined,s){const o=s?this.getBitFieldValue(s):0;const n=s?.widget?.units?"flex right-align":"flex";switch(t){case"label":return i("gc-widget-label",{id:r,label:s?this.getReadOnlyDisplayValue(s,o):undefined});case"checkbox":return i("gc-widget-checkbox",{id:r,readonly:e,checked:o!==0,"onChecked-changed":this.onWidgetValueChanged});case"select":return i("gc-widget-select",{id:r,class:n,readonly:e,"selected-value":o,values:s?this.getSelectValues(s):"0",labels:s?this.getSelectLabels(s):"_","onSelected-value-changed":this.onWidgetValueChanged});case"spinner":return i("gc-widget-spinner",{id:r,class:"flex right-align",readonly:e,value:o,"min-value":s?.widget?.min,"max-value":s?.widget?.max,increment:s?.widget?.step,format:s?this.getFormat(s):"dec",precision:s?this.getPrecision(s):undefined,"onValue-changed":this.onWidgetValueChanged});case"indicator":return i("gc-widget-led",{id:r,on:o!==0,onClick:this.onIndicatorToggle,tabIndex:0,style:{"--gc-on-color":s?.widget?.onColor,"--gc-off-color":s?.widget?.offColor},onKeyDown:this.onIndicatorKeyHandler});default:return i("gc-widget-input",{id:r,class:n,readonly:e,value:o,format:s?this.getFormat(s):"hex",precision:s?this.getPrecision(s):4,"onValue-changed":this.onWidgetValueChanged})}}renderBitField(t,e=-1,r){const s=r?this.isReadOnly(r):false;const o=e<0?undefined:`${e}`;const n=e<0?false:e===this.selectedFieldIndex;const a=e<0||!n&&this.selectedFieldIndex>=0;const h=this.generateKey(t);return i("div",{class:"field-container",key:h,id:h,hidden:a},i("div",{class:"header-container"},i("div",{class:"caption"},`${r?.name??""}[${this.getBitFieldRange(r)}]`),i("gc-widget-icon",{id:o,appearance:n?"primary":"custom",icon:n?"navigation:cancel":"action:help_outline",size:n?"s":"xs",onClick:this.toggleHelp})),i("div",{class:"widget-container"},i("gc-widget-icon",{hidden:!s,size:"xs",appearance:"tertiary",icon:"action:lock"}),this.renderBitFieldWidget(t,s,o,r),r?.widget?.units?i("gc-widget-label",{label:r.widget.units}):null))}render(){const t=this.registerInfo?.fields[this.selectedFieldIndex]??{name:"",start:0,stop:0};const e=this.selectedFieldIndex<0;this.keyCounters.forEach((t=>t.count=0));const r=this.registerInfo?.fields?.map(((t,e)=>t.attrs?.isHidden?null:this.renderBitField(this.getBifFieldWidgetType(t),e,t)))??[];const s=[];this.keyCounters.forEach(((t,e)=>{while(t.count<t.total){s.push(this.renderBitField(e))}}));return i("div",{class:"container"},this.heading?i("div",{key:"heading",class:"heading"},this.heading):null,i("div",{key:"sub-heading",class:"sub-heading"},this.getRegisterDisplayName()),i("div",{key:"scroll-container",class:"scroll-container"},s,r,e?null:i("div",{key:"forceDividerLine"}),i("div",{class:"info-container",key:"information",hidden:e},i("div",{class:"info-title"},"Field"),i("gc-widget-label",{label:t.title||t.name}),i("div",{class:"info-title"},"Bit"),i("gc-widget-label",{label:this.getBitFieldRange(t," - ")}),i("div",{class:"info-title"},"Type"),i("gc-widget-label",{label:this.getBitFieldType(t)}),i("div",{class:"info-title"},"Description"),i("div",{innerHTML:t.desc?.split("\n").join("<br>")}))))}addRegisterBindListener(){if(this.registerModel){this.registerModel.getBinding("$registerDefinitions").addEventListener(n,this.onRegisterSymbolsChangedListener);if(this.registerInfo){this.registerValueBind=this.registerModel.getBinding(this.getSymbolName(this.registerInfo));this.registerValueBind.addEventListener(n,this.onRegisterValueChangedListener)}}}removeRegisterBindListener(){if(this.registerValueBind){this.registerValueBind.removeEventListener(n,this.onRegisterValueChangedListener);this.registerValueBind=undefined}if(this.registerModel){this.registerModel.getBinding("$registerDefinitions").removeEventListener(n,this.onRegisterSymbolsChangedListener)}}connectedCallback(){this.onRegisterInfoChanged()}disconnectedCallBack(){this.removeRegisterBindListener()}componentWillRender(){this.isRendering=true}componentDidRender(){this.isRendering=false}onValueChanged(){this.registerValueBind?.setValue(this.value);this.valueChanged.emit({value:this.value})}onRegisterInfoChanged(){this.removeRegisterBindListener();let t;if(this.registerModelId){t=a.getModel(this.registerModelId);if(!t&&this.registerModelId){c.whenConfigurationReady(this.registerModelId).then((()=>this.onRegisterInfoChanged()))}}this.registerModel=t?.getConvertedValue?t:undefined;this.onRegisterSymbolsChangedListener();this.addRegisterBindListener();if(this.registerInfo){this.onRegisterValueChangedListener()}}onSelectedFieldChanged(){this.selectedFieldIndexChanged.emit({value:this.selectedFieldIndex})}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return r(this)}static get watchers(){return{value:["onValueChanged"],registerModelId:["onRegisterInfoChanged"],registerName:["onRegisterInfoChanged"],selectedFieldIndex:["onSelectedFieldChanged"]}}};u.style=f;const p=":host{background-color:var(--gc-heading-color, var(--gc-border-color, var(--theme-border-color, #e5e5e5)));font-weight:var(--gc-font-weight, 500);font-size:var(--gc-font-size, var(--gc-font-size, var(--theme-font-size, 14px)));font-style:var(--gc-font-style, normal);white-space:nowrap;margin:0px;position:sticky;top:0%;text-align:var(--gc-heading-text-align, center);width:100%;align-self:stretch;box-sizing:border-box}:host(:focus),:host *:focus{outline:none}.header-container{width:100%;height:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)))}.header-container>*:not(.stretch){flex-shrink:0}.stretch{flex:1}label,gc-widget-label{overflow:hidden;text-overflow:ellipsis;padding:5px 5px 5px 5px}slot::slotted(*:focus),.action:focus{outline:1px dotted var(--gc-focus-color, var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555))));outline-offset:1px}.action{--gc-color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));cursor:pointer}";const m=52;const b=22;function v(t,e){return{display:e?"none":"grid","grid-template-columns":t>m?"min-content":`repeat(${t}, ${b}px)`}}class x{constructor(t,e){this.params=t;this.parentTree=e;this.onToggleBitClickHandler=t=>{this.doToggleBit(t.currentTarget)};this.bitSelectClickHandler=t=>{const e=t.target;const i=e.id.split(":");if(i.length>1){this.params.selectedBit=+i[1];this.setFocusOnBit(t.currentTarget,this.params.selectedBit)}};this.onFocusHandler=t=>{const e=t.currentTarget;this.setFocusOnBit(e,this.params.selectedBit)};this.onBlurHandler=t=>{this.setFocusOnBit(t.currentTarget,-1)};this.onKeyboardHandler=t=>{let e=this.params.selectedBit;const i=t.currentTarget;switch(t.key){case"1":case"0":case"Enter":case" ":if((this.getCell(i,e)?.innerHTML??t.key)!==t.key){this.doToggleBit(this.getCell(i,e))}t.stopPropagation();t.preventDefault();break;case"F2":e-=1;case"ArrowLeft":e+=2;case"ArrowRight":e-=1;if(e>=0&&e<(this.params.dataBits||1)){this.params.selectedBit=e;this.setFocusOnBit(i,e);t.stopPropagation();t.preventDefault()}break;case"Escape":this.setFocusOnBit(i,-1);t.stopPropagation();t.preventDefault();break}};this.align="center";this.hideFocusRectangle=true}getCell(t,e){if(e<0){return undefined}return t.querySelector(`span:nth-last-child(${e+1})`)}doToggleBit(t){const e=t?.id.split(":")??[];if(e.length===2){const t=+e[0];const i=+e[1];const r=this.parentTree.getCommittedEditValue(t,this.params.name);const o=s.bitField.getMask(i,i);const n=s.bitField.writeField(r,o,i,s.bitField.readField(r,o,i)^1);this.parentTree.commitEditValueChange(+e[0],this.params.name,n)}}setFocusOnBit(t,e){const i=this.getCell(t,e);if(this.focusedElement&&this.focusedElement!==i){this.focusedElement.classList.remove("focused");this.focusedElement=undefined}this.focusedElement=i;if(this.focusedElement&&!this.focusedElement.classList.contains("focused")){this.focusedElement.classList.add("focused");this.parentTree.scrollIntoViewHorizontally(this.focusedElement)}}renderCell(t,e,r,o,n){const a=this.params.dataBits||1;const h=e.getValue("value");const c=h!==undefined?e.getValue("committedValue"):0;let l=a>m?1:s.bitField.getMask(a-1,a-1);const d=this.params.minimized||this.params.hidden;const g=a<=m?new Array(a).fill(null).map(((o,n)=>{const d=a-n-1;let g;let f;let u;if(h!==undefined){const t=s.bitField.readField(e.getValue("reservedMask")??0,l)!==0;u=t||s.bitField.readField(e.getValue("readonlyMask")??0,l)!==0;const i=s.bitField.readField(e.getValue("visibleMask")??-1,l)===0;const o=r?s.bitField.readField(this.params.selectedBitsMask||0,l)!==0:false;f=t?"-":i?"":s.bitField.readField(h,l)?"1":"0";const n=t||i||u?false:f!==(s.bitField.readField(c,l)?"1":"0");g=`bit-cell${u?" readonly":""}${i?" empty":""}${o?" selected":""}${n?" deferred":""}`}else{f="";g="bit-cell empty";u=true}l=Number(BigInt(l)>>1n);return i("span",{id:`${t}:${d}${u?":R":""}`,part:g,onDblClick:this.onToggleBitClickHandler},f)})):[i("span",null)];const f=i("div",{part:"bits-container",tabIndex:n,style:v(a,d),onMouseDown:this.bitSelectClickHandler,onKeyDown:this.onKeyboardHandler,onFocus:this.onFocusHandler,onBlur:this.onBlurHandler},g);return{element:f,focusable:!d}}restoreEditorSelectionState(t,e){switch(e.hint){case"ArrowRight":case"Home":this.params.selectedBit=(this.params.dataBits||1)-1;break;case"ArrowLeft":case"End":this.params.selectedBit=0;break}this.setFocusOnBit(t,this.params.selectedBit)}}let w=class{constructor(i){t(this,i);this.selectedBitChanged=e(this,"selected-bit-changed",7);this.minimizedChanged=e(this,"minimized-changed",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.base=new class extends l{get element(){return this.parent.el}}(this);this.selectedBit=-1;this.onFocusHandler=()=>{this.base.parentGrid?.setFocus()};this.hideMinimizeAction=false;this.minimized=false;this._refresh=0;this.hidden=false}onSelectedBitChanged(){this.selectedBitChanged.emit({value:this.selectedBit})}render(){const t=this.dataBits||1;const e=t<=m?new Array(t).fill(null).map(((e,r)=>i("span",{part:`bit-cell${r===0?" first-child":""}`},t-r-1))):[i("span",{part:"bit-cell"},`Greater than ${m} bit wide registers are not supported`)];return i("div",{style:{display:"flex","flex-direction":"column"},tabIndex:-1,onFocus:this.onFocusHandler},this.base.renderHeader(),this.hidden||this.minimized?i("div",{part:"bits-header-padding"},"1"):null,i("div",{part:"bits-container",style:v(t,this.hidden||this.minimized)},e))}async createCellRenderer(t){this.base.parentGrid=t;return new x(this,t)}onColumnPropertyChanged(){this.base.parentGrid?.redraw()}onMinimizedChanged(){this.minimizedChanged.emit({value:this.minimized})}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return r(this)}static get watchers(){return{selectedBit:["onSelectedBitChanged"],dataBits:["onColumnPropertyChanged"],selectedBitsMask:["onColumnPropertyChanged"],hidden:["onColumnPropertyChanged"],hideMinimizeAction:["onColumnPropertyChanged"],minimized:["onColumnPropertyChanged","onMinimizedChanged"]}}};w.style=p;const k=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}gc-widget-grid-tree-column{--gc-column-width:minmax(220px, 1fr)}gc-widget-grid-data-column{--gc-text-align:center}:host{border:2px solid var(--gc-border-color, var(--gc-border-color, var(--theme-border-color, #e5e5e5)))}#grid{width:100%;height:100%;margin:0px;border:none}#grid::part(open){font-style:italic}#grid::part(branch){font-weight:500;font-size:93%}#grid::part(leaf){font-size:86%}#bitsHeader::part(bit-cell){border:1px solid var(--gc-background-color, var(--gc-background-color, var(--theme-background-color, #ffffff)));border-bottom-width:0px;border-right-width:0px;font-weight:400}#bitsHeader::part(bit-cell first-child){border-left-color:transparent}#bitsHeader::part(bit-cell),#grid::part(bit-cell){width:100%;display:inline-flex;align-items:center;justify-content:center}#grid::part(bit-cell readonly){background-color:var(--gc-background-color-disabled, var(--theme-background-color-disabled, #e5e5e5));color:var(--gc-font-color-disabled, var(--theme-font-color-disabled, #999999))}#grid::part(bit-cell selected){background-color:var(--gc-register-field-background-color-selected, #ffffb3)}#grid::part(deferred){text-decoration:underline;font-style:italic}#grid::part(bits-container),#bitsHeader::part(bits-container){grid-gap:0;grid-template-rows:1fr;justify-items:center;height:100%}#grid::part(bits-container){padding-right:1px;padding-left:2px}#bitsHeader::part(bits-header-padding){overflow:hidden;width:0px;display:none;}#grid::part(focused){outline:1px dotted var(--gc-outline-color-focus, var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555))));outline-offset:-3px}';class y{constructor(t,e){this.reservedMask=0;this.isVisibleInGrid=false;this.name=t.id||t.name;this.address=t.addr;this.binding=e.getBinding(this.name);this.readonly=t.attrs?.readonly??false;this.path=`${t.groupName}/${this.name}`;this.visibleMask=s.bitField.getMask(0,(t.size||t.nBytes*8||8)-1);this.readonlyMask=this.readonly?this.visibleMask:0;t.fields?.forEach((t=>{if(t.attrs){const e=s.bitField.getMask(t.start,t.stop);if(t.attrs.isHidden){this.visibleMask=s.bitField.writeField(this.visibleMask,e,t.start,0)}if(t.attrs.isLocked){this.readonlyMask=s.bitField.writeField(this.readonlyMask,e,t.start,-1)}if(t.attrs.isReserved){this.reservedMask=s.bitField.writeField(this.reservedMask,e,t.start,-1)}}}))}get value(){return this.binding.getValue()}set value(t){if(!this.readonly){this.binding.setValue(t)}}get status(){return this.binding.status}get committedValue(){return this.binding.getValueCommitted()}get isDeferredWritePending(){return this.binding.isDeferredWritePending()}}class C{constructor(t,e){this.name=t.name;this.registers=t.registers.filter((t=>!t.attrs?.isHidden)).map((t=>new y(t,e)))}addChangeListeners(t){this.registers.forEach((e=>e.binding.addEventListener(n,t)))}removeChangeListeners(t){this.registers.forEach((e=>e.binding.removeEventListener(n,t)))}get rowCount(){return this.registers.length}getValue(t,e){return this.registers[t][e]}setValue(t,e,i){this.registers[t][e]=i}isReadonly(t){return this.registers[t].readonly}lookupRowByName(t){return this.registers.findIndex((e=>e.name===t))}lookupRegisterByName(t){return this.registers[this.lookupRowByName(t)]}getPartName(t,e){return e==="value"&&this.registers[t].isDeferredWritePending?"deferred":""}}class z extends C{updateChangedEventListener(t){if(this.onChangedEventListener){if(t.isVisibleInGrid){t.binding.addEventListener(n,this.onChangedEventListener)}else{t.binding.removeEventListener(n,this.onChangedEventListener)}}}setVisibility(t,e){const i=this.registers[t];if(!i){return}if(i.isVisibleInGrid===e){return}i.isVisibleInGrid=e;this.updateChangedEventListener(i)}addChangeListeners(t){this.onChangedEventListener=t;this.registers.forEach((t=>this.updateChangedEventListener(t)))}removeChangeListeners(t){this.onChangedEventListener=undefined;super.removeChangeListeners(t)}}class ${constructor(t,e){const i=t?.getBinding("$registerDefinitions")?.getValue();this.dataBits=i?.info.regsize||16;const r=i?.regblocks.reduce(((t,e)=>e.registers.reduce(((t,e)=>Math.max(t,e.addr)),t)),0)||255;this.addressSize=r.toString(16).length;this.groups=i?.regblocks.filter((t=>!t.attrs?.isHidden)).map((i=>{if(e){return new z(i,t)}return new C(i,t)}))??[]}isExpandable(t){return true}getChildDataProvider(t){return this.groups[t]}get rowCount(){return this.groups.length}getValue(t,e){return this.groups[t][e]}setValue(){}lookupRowByName(t){return this.groups.findIndex((e=>e.name===t))}addChangeListeners(t){this.groups.forEach((e=>e.addChangeListeners(t)))}removeChangeListeners(t){this.groups.forEach((e=>e.removeChangeListeners(t)))}lookupRegisterByName(t){if(!t){return}return this.groups.reduce(((e,i)=>e??i.lookupRegisterByName(t)),undefined)}}let R=class{constructor(i){t(this,i);this.selectedRegisterChanged=e(this,"selected-register-changed",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.fontSize=R.REFERENCE_FONT_SIZE;this.registerModelIdMap=new Map;this.selectedRegisterPath="";this.virtual=false;this.selectedRegister="";this.sortDescending=false;this.hideAddressColumn=false;this.hideBitsColumn=false;this.onSelectedPathChanged=()=>{this.selectedRegisterPath=this.grid?.selectedPath??"";const t=this.selectedRegisterPath.split("/");if(t.length>1){this.selectedRegister=t[1]}else{this.selectedRegister=""}};this.onRegisterValueChangedListener=()=>{this.grid?.refresh()};this.onRegisterSymbolsChangedListener=()=>{this.dataProvider?.removeChangeListeners(this.onRegisterValueChangedListener);this.dataProvider=new $(this.registerModel,this.virtual);this.grid?.setDataProvider(this.dataProvider,this.getExpandToLevel(),this.registerModel?this.registerModelId:undefined);this.dataProvider.addChangeListeners(this.onRegisterValueChangedListener)};this._refresh=0;this.hidden=false}onVirtualChanged(){this.onRegisterSymbolsChangedListener()}getExpandToLevel(){if(this.registerModel&&this.dataProvider&&this.dataProvider.rowCount>0){if(this.registerModelIdMap.has(this.registerModelId)){return 0}this.registerModelIdMap.set(this.registerModelId,true)}return 2}async addRegisterDefinitionsListener(){if(this.registerModelId){this.registerModel=a.getModel(this.registerModelId);if(!this.registerModel){const t=this.registerModelId;await c.whenConfigurationReady(this.registerModelId);if(this.registerModelId!==t){return}this.registerModel=a.getModel(this.registerModelId)}}this.onRegisterSymbolsChangedListener();if(this.registerModel){this.registerModel.getBinding("$registerDefinitions").addEventListener(n,this.onRegisterSymbolsChangedListener)}}removeRegisterDefinitionsListener(){if(this.registerModel){this.registerModel.getBinding("$registerDefinitions").removeEventListener(n,this.onRegisterSymbolsChangedListener)}this.registerModel=undefined}get addressPrecision(){return this.addressBits?Math.ceil(this.addressBits/4):this.dataProvider?.addressSize||2}get displayBits(){return this.dataBits||this.dataProvider?.dataBits||8}get dataPrecision(){return Math.ceil(this.displayBits/4)}componentWillRender(){const t=Number.parseFloat(getComputedStyle(this.el).getPropertyValue("font-size"));if(!isNaN(t)){this.fontSize=t}}render(){const t=Math.ceil((Math.max(this.dataPrecision,8)+2)*10*this.fontSize/R.REFERENCE_FONT_SIZE);let e=0;if(this.selectedField&&this.selectedRegister){const t=this.registerModel?.getRegisterInfo(`${this.selectedRegister}.${this.selectedField}`);if(t){e=s.bitField.getMask(t.start,t.stop)}}return i("gc-widget-grid",{id:"grid",ref:t=>this.grid=t,selectedPath:this.selectedRegisterPath,"onSelected-path-changed":this.onSelectedPathChanged,filterText:this.filterText,sortByColumn:this.sortBy,sortDescending:this.sortDescending,virtual:this.virtual},i("gc-widget-grid-tree-column",{heading:"Register Name",hideMinimizeAction:true,showInfoIcon:true},i("slot",null)),this.hideAddressColumn?null:i("gc-widget-grid-data-column",{key:"address",heading:"Address",name:"address",readonly:true,format:"hex",precision:this.addressPrecision}),i("gc-widget-grid-data-column",{key:"value",heading:"Value",name:"value",format:"hex",precision:this.dataPrecision,style:{"--gc-column-width":`${t}px`}}),this.hideBitsColumn?null:i("gc-widget-register-bits-column",{id:"bitsHeader",heading:"Bits",name:"value",dataBits:this.displayBits,selectedBitsMask:e}))}onRegisterModelIdChanged(){this.removeRegisterDefinitionsListener();this.addRegisterDefinitionsListener()}onSelectedRegisterChanged(){let t;if(this.selectedRegister){t=this.dataProvider?.lookupRegisterByName(this.selectedRegister);this.selectedRegisterPath=t?.path??""}else if(this.selectedRegisterPath.split("/").length>1){this.selectedRegisterPath=""}this.selectedRegisterChanged.emit({value:this.selectedRegister})}async lookupFieldByBit(t){const e=this.registerModel?.getRegisterInfo(this.selectedRegister);const i=e?.fields?.find((e=>e.start>=t&&e.stop<=t));return i?.id||i?.name}async setFilterMethod(t){this.grid?.setFilterMethod(t)}async redrawGrid(){this.grid?.refresh()}expandToLevel(t){if(!this.grid){throw new Error("Register grid not rendered yet.  You cannot expand levels until the grid has rendered at least once.")}return this.grid.expandToLevel(t)}connectedCallback(){this.addRegisterDefinitionsListener()}disconnectedCallBack(){this.removeRegisterDefinitionsListener()}componentDidLoad(){if(this.dataProvider){this.grid?.setDataProvider(this.dataProvider,2,this.registerModel?this.registerModelId:undefined)}}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return r(this)}static get watchers(){return{virtual:["onVirtualChanged"],registerModelId:["onRegisterModelIdChanged"],selectedRegister:["onSelectedRegisterChanged"]}}};R.REFERENCE_FONT_SIZE=14;R.style=k;const S=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}.root-container{height:100%;width:100%;position:relative;overflow:hidden}.root-container *{margin:0px}.row{display:flex;flex-direction:row;justify-content:flex-start;align-items:flex-start}.row>*{margin:5px}.row.center{align-items:center}.row.bottom{align-items:flex-end}.row.justify-end{justify-content:flex-end}.row.wrap{flex-wrap:wrap}.column{display:flex;flex-direction:column}div{position:relative}.stretch{flex:1;flex-basis:0.0000001px}#bitFieldViewer{width:334px;height:100%;margin:0px;padding:5px 0 0 10px;box-sizing:border-box}gc-widget-select{min-width:95px}.title{position:relative;padding:5px;margin-top:15px;margin-bottom:15px;width:min-content;white-space:nowrap}.title:before{content:"";position:absolute;width:40%;height:1px;bottom:2px;border-bottom:2px solid var(--theme-primary-color, #cc0000)}.title .heading{font-size:var(--gc-header-font-size, var(--theme-header-font-size, 21px));font-weight:var(--gc-header-font-weight, var(--theme-header-font-weight, 500))}.title .sub-heading{font-size:var(--gc-sub-header-font-size, var(--theme-sub-header-font-size, 14px));padding-left:10px}#search{margin:0px 5px 4px 0px}.fill{width:100%;height:100%;margin:0px;box-sizing:border-box}#main{overflow-x:auto;overflow-y:hidden}#main *.stretch{min-width:0px}.no-shrink{flex-shrink:0}#registerDetails{overflow-x:hidden;overflow-y:auto}#registerDetails table{border-collapse:collapse;width:100%;box-sizing:border-box;user-select:text}#registerDetails>div{margin:10px 5px 5px 5px}#registerDetails>.detail-heading{font-size:125%;font-weight:bold;display:inline}#registerDetails th{background-color:var(--gc-heading-color, var(--gc-border-color, var(--gc-border-color, var(--theme-border-color, #e5e5e5))));color:var(--gc-heading-font-color);vertical-align:middle;text-align:center}#registerDetails th,#registerDetails td{border:2px solid var(--gc-border-color, var(--gc-border-color, var(--theme-border-color, #e5e5e5)))}#registerDetails td{padding:10px;vertical-align:top;text-align:left;white-space:nowrap}#registerDetails td.col3{white-space:normal;overflow-wrap:break-word}.clickable{margin:5px;cursor:pointer}#deferredModeSwitch{min-height:30px;}';let D=class{constructor(i){t(this,i);this.autoReadValueChanged=e(this,"auto-read-value-changed",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.modelReadyPromises=new Map;this.modelsDeferred=new Map;this.searchBitFields=false;this.modelIdLabels="";this.selectedFieldIndex=-1;this.activeDeviceName="";this.deferredWriteEnabled=false;this.filterText="";this.virtual=false;this.hideDeviceName=false;this.autoReadValue=undefined;this.onSelectedRegisterChanged=t=>{this.selectedRegister=t.detail.value};this.onSelectedFieldIndexChanged=t=>{this.selectedFieldIndex=t.detail.value};this.onSearchBitFieldsCheckedChanged=t=>{this.searchBitFields=t.detail.value;this.setFilterMethod()};this.onSelectedModelChanged=t=>{this.setActiveModel(t.detail.value)};this.onModelRefreshRateValueChanged=t=>{this.setAutoReadValue(t.newValue)};this.onRegisterDefinitionsChanged=t=>{this.activeDeviceRegisterInfo=t.newValue};this.onAutoReadSelectedValueChanged=t=>{const e=this.activeRegisterModel?.getBinding("$refresh_interval");e?.setValue(t.detail.value)};this.onFilterTextChanged=t=>{this.filterText=t.detail.value};this.doRead=()=>{if(!this.activeRegisterModel?.isConnected()){g.error("Must be connected to target to read registers.");return}const t=this.activeRegisterModel?.getBinding(this.selectedRegister);if(t?.refresh){this.startProgress("Read");t.refresh(this.busyProgress);this.busyProgress.done()}};this.doReadAll=()=>{if(!this.activeRegisterModel?.isConnected()){g.error("Must be connected to target to read registers.");return}if(this.activeRegisterModel?.refreshAllBindings){this.startProgress("Read");this.activeRegisterModel.refreshAllBindings(this.busyProgress);this.busyProgress.done()}};this.doWrite=()=>{const t=this.activeRegisterModel?.getBinding(this.selectedRegister);if(t){if(this.activeRegisterModel.isConnected()){this.startProgress()}else{g.warning(`Write to ${this.selectedRegister} enqueued - not connected to target.`)}this.doWriteDeferredRegister(t,true);if(this.busyProgress){this.busyProgress.done();this.grid?.redrawGrid()}}};this.doWriteAll=()=>{if(this.activeDeviceRegisterInfo?.regblocks.length>0){if(this.activeRegisterModel.isConnected()){this.startProgress()}else{const t=this.getUncommittedWriteCount(this.activeRegisterModel);if(t>0){g.warning(`Write to ${t} register(s) enqueued - not connected to target.`)}}this.activeDeviceRegisterInfo.regblocks.forEach((t=>{t.registers.forEach((t=>{this.doWriteDeferredRegister(this.activeRegisterModel?.getBinding(t.id))}))}));if(this.busyProgress){this.busyProgress.done();this.grid?.redrawGrid()}}};this.onWriteDeferredModeChanged=async t=>{const e=t.detail.value?true:false;if(e===this.deferredWriteEnabled){return}let i;if(this.activeRegisterModelId){this.modelsDeferred.set(this.activeRegisterModelId,e)}const r=e?0:this.getUncommittedWriteCount(this.activeRegisterModel);if(r>0){i=await g.prompt("Register View","Commit Pending Writes?","content:create",true,false,"no,yes")}if(i==="dismiss"){this.deferredModeToggle.checked=true;return}if(i==="yes"){if(this.activeRegisterModel?.isConnected()){this.startProgress()}else{g.warning(`Write to ${r} register(s) enqueued - not connected to target.`)}}this.activeDeviceRegisterInfo?.regblocks.forEach((t=>{t.registers.forEach((t=>{const r=this.activeRegisterModel?.getBinding(t.id);if(i==="no"){r?.clearDeferredWrite()}r?.setDeferredMode(e,this.busyProgress,false)}))}));this.busyProgress?.done();if(i==="yes"){this.grid.redrawGrid()}this.deferredWriteEnabled=e};this.toggleDetails=()=>{this.showDetails=this.showDetails?undefined:this.selectedRegister;this.setFilterMethod()};this.filterRegisterForDetailsCallback=(t,e,i)=>{const r=""+e.getValue(t,"name");return r===i&&!e.isExpandable?.(t)};this.filterRegistersOnlyCallback=(t,e,i,r)=>{if(r){return false}const s=""+e.getValue(t,"name");if(e.isExpandable){return this.hasFilterRegister(s,i)}return s?.toLowerCase().includes(i)??false};this.filterRegistersAndFieldsCallback=(t,e,i,r)=>{if(this.filterRegistersOnlyCallback(t,e,i,r)){return true}if(!r&&this.activeRegisterModelId){const r=""+e.getValue(t,"name");const s=this.activeRegisterModel?.getRegisterInfo(r);return this.hasFilteredField(s,i)}return false};this._refresh=0;this.hidden=false}async setActiveModel(t){if(this.refreshIntervalBind){this.refreshIntervalBind.removeEventListener(n,this.onModelRefreshRateValueChanged);this.refreshIntervalBind=undefined}if(this.registerDefinitionsBind){this.registerDefinitionsBind.removeEventListener(n,this.onRegisterDefinitionsChanged);this.registerDefinitionsBind=undefined}this.activeRegisterModelId=t;this.activeRegisterModel=undefined;this.activeDeviceRegisterInfo=undefined;if(t){if(!this.modelReadyPromises.has(t)){this.modelReadyPromises.set(t,d.timeout(c.whenConfigurationReady(t),5e3,"Timeout on model ready"))}await this.modelReadyPromises.get(t);const e=a.getModel(t);if(e&&this.activeRegisterModelId===t){this.refreshIntervalBind=e.getBinding("$refresh_interval");if(this.refreshIntervalBind){this.refreshIntervalBind.addEventListener(n,this.onModelRefreshRateValueChanged);if(this.autoReadValue!==undefined&&this.refreshIntervalBind.getValue()!==this.autoReadValue){this.refreshIntervalBind.setValue(this.autoReadValue)}else{this.setAutoReadValue(+this.refreshIntervalBind.getValue())}}this.activeRegisterModel=e;this.registerDefinitionsBind=this.activeRegisterModel.getBinding("$registerDefinitions");if(this.registerDefinitionsBind){this.registerDefinitionsBind?.addEventListener(n,this.onRegisterDefinitionsChanged);this.activeDeviceRegisterInfo=this.registerDefinitionsBind?.getValue();this.deferredWriteEnabled=this.modelsDeferred.get(this.activeRegisterModelId)??false}}}}get autoReadLabels(){return this.autoReadSelectorLabels||"Off|As fast as possible|15ms Delay|50ms Delay|100ms Delay|500ms Delay|1s Delay|5s Delay|10s Delay|60s Delay"}get autoReadValues(){return this.autoReadSelectorValues||"-1,0,15,50,100,500,1000,5000,10000,60000"}setAutoReadValue(t){if(this.autoReadValue!==t){this.autoReadValue=t;this.autoReadValueChanged.emit({value:t})}}async startProgress(t="Written"){const e=this.busyProgress=new h;const{progress:i,result:r}=await g.progress("",`${t.substring(0,4)}ing registers ...`,"",true,0,100,true);const s=setInterval((()=>{const r=e.count-1;const s=e.totalCount-1;if(r<s){i.setMessage(`${r} of ${s} registers ${t.toLowerCase()}`)}else{i.setMessage(`${s} registers ${t.toLowerCase()}`)}i.setValue(e.getProgress())}),100);await r;clearInterval(s);this.busyProgress=undefined}doWriteDeferredRegister(t,e=false){if(e||t?.isDeferredWritePending()){t.setDeferredMode(false,this.busyProgress,e);t.setDeferredMode(true)}}getUncommittedWriteCount(t){return this.activeDeviceRegisterInfo?.regblocks.reduce(((e,i)=>e+i.registers.reduce(((e,i)=>e+(t.getBinding(i.id)?.isDeferredWritePending()?1:0)),0)),0)}hasFilteredField(t,e){const i=t?.fields??[];for(let t=0;t<i.length;t++){if(i[t].name?.toLowerCase().includes(e)&&!(i[t].attrs?.isHidden||i[t].name.toLowerCase()==="reserved"&&i[t].attrs?.isReserved)){return true}}return false}hasFilterRegister(t,e){const i=this.activeDeviceRegisterInfo?.regblocks.find((e=>e.name===t));return i.registers.reduce(((t,i)=>{t=t||i.name.toLowerCase().includes(e);if(this.searchBitFields){t=t||this.hasFilteredField(i,e)}return t}),false)}setFilterMethod(){this.grid?.setFilterMethod(this.showDetails?this.filterRegisterForDetailsCallback:this.searchBitFields?this.filterRegistersAndFieldsCallback:this.filterRegistersOnlyCallback)}renderFieldDetail(t){return i("tr",null,i("td",null,t.stop,":",t.start),i("td",null,t.name),i("td",{class:"col3",innerHTML:t.desc?.split("\n").join("<br>")}))}renderDetails(t){const e=o.convert(t.default??0,"number","hex",t.nBytes*2);return i("div",{id:"registerDetails",class:"stretch"},i("div",{class:"detail-heading"},t.title||t.name),i("gc-widget-icon",{appearance:"primary",icon:"navigation:cancel",size:"s",class:"clickable",onClick:this.toggleDetails}),i("div",{innerHTML:t.desc?.split("\n").join("<br/>")??""}),i("div",null,`Default value: ${e}`),i("table",null,i("tr",null,i("th",null,"Bits"),i("th",null,"Name"),i("th",null,"Description")),t.fields?.map((t=>this.renderFieldDetail(t)))))}render(){const t=this.modelIdLabels.indexOf(";")>0;const e=this.activeRegisterModel?.getRegisterInfo(this.selectedRegister);const r=e?.fields?.[this.selectedFieldIndex];const s=this.busyProgress!==undefined||this.autoReadValue>-1;const o=!this.deferredWriteEnabled||!e||e.attrs?.readonly;const n=this.hideDeviceName?undefined:this.activeDeviceRegisterInfo?.info.name;const a=this.showDetails?this.activeRegisterModel?.getRegisterInfo(this.showDetails):undefined;return i("div",{class:"root-container column"},i("div",{class:"row bottom"},i("div",{class:"stretch"},i("div",{class:"title"},i("span",{class:"heading"},"Register Map"),i("span",{class:"sub-heading"},n))),t?i("gc-widget-select",{id:"modelSelect",key:"models",caption:"Register model",labels:this.modelIdLabels,"onSelected-label-changed":this.onSelectedModelChanged,initialIndex:0}):null,i("slot",null),i("gc-widget-select",{id:"autoReadSelect",key:"autoRead",caption:"Auto read",labels:this.autoReadLabels,values:this.autoReadValues,selectedValue:this.autoReadValue,"onSelected-value-changed":this.onAutoReadSelectedValueChanged}),i("gc-widget-button",{id:"read",label:"Read",disabled:e===undefined||s,onClick:this.doRead}),i("gc-widget-button",{id:"readAll",label:"Read all",disabled:s,onClick:this.doReadAll}),i("gc-widget-button",{id:"write",label:"Write",disabled:o,onClick:this.doWrite}),i("gc-widget-button",{id:"writeAll",label:"Write all",disabled:!this.deferredWriteEnabled,onClick:this.doWriteAll}),i("gc-widget-toggle-switch",{id:"deferredModeSwitch",caption:"Write mode",label:"Immediate",labelWhenChecked:"Deferred","onChecked-changed":this.onWriteDeferredModeChanged,checked:this.deferredWriteEnabled,ref:t=>this.deferredModeToggle=t})),i("gc-widget-container",{class:"stretch"},i("div",{class:"row fill",id:"main"},i("div",{class:"stretch column fill"},i("div",{class:"row center"},i("gc-widget-input-filter",{id:"search",placeholder:"Search registers by name",class:"stretch",hasClearIcon:true,hasSearchIcon:true,selectOnFocus:true,intermediateChanges:true,"onValue-changed":this.onFilterTextChanged}),i("gc-widget-checkbox",{id:"searchBitFieldsCheckbox",label:"Search bitfields","onChecked-changed":this.onSearchBitFieldsCheckedChanged})),i("gc-widget-container",{class:a?"no-shrink":"stretch"},i("gc-widget-register-grid",{id:"registerGrid",ref:t=>this.grid=t,class:"fill","register-model-id":this.activeRegisterModelId,virtual:this.virtual,"selected-field":r?.id,"onSelected-register-changed":this.onSelectedRegisterChanged,filterText:a?this.showDetails:this.filterText?.toLowerCase()})),a?this.renderDetails(a):null),i("gc-widget-register-bitfield-viewer",{id:"bitFieldViewer",heading:"Field View",registerModelId:this.activeRegisterModelId,registerName:this.selectedRegister,"onSelected-field-index-changed":this.onSelectedFieldIndexChanged}))))}connectedCallback(){const t=document.querySelectorAll("gc-model-register");const e=[];if(t){t.forEach((t=>e.push(t.id)))}this.modelIdLabels=e.join(";");this.setActiveModel(e[0])}disconnectedCallback(){this.setActiveModel()}componentDidLoad(){this.setFilterMethod()}onInfoIconClicked(){this.toggleDetails()}async getRegisterData(t){if(!this.activeRegisterModel){throw new Error(`Failed to get register data in ${t} format: there is no active register model selected.`)}return this.activeRegisterModel.getRegisterData(t)}async setRegisterData(t){if(!this.activeRegisterModel){throw new Error("Failed to set register data from a text file: there is no active register model selected.")}this.activeRegisterModel.setRegisterData(t)}expandToLevel(t){if(!this.grid){throw new Error("Register view not rendered yet.  You cannot expand levels until the register view has rendered at least once.")}return this.grid.expandToLevel(t)}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return r(this)}};D.style=S;export{u as gc_widget_register_bitfield_viewer,w as gc_widget_register_bits_column,R as gc_widget_register_grid,D as gc_widget_register_view};
//# sourceMappingURL=p-75d2b5cf.entry.js.map