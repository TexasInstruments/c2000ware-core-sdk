import{r as t,c as e,h as i,g as s}from"./p-823ca21f.js";import{GcConsole as o}from"../gc-core-assets/lib/GcConsole";import{ActionRegistry as r}from"../gc-widget-menu/lib/ActionRegistry";import{nullDataProvider as n}from"../gc-widget-grid/lib/NullDataProvider";const a="annotationCellValue";const c="addressCellValue";const h="instructionCellValue";const l="dasmInstruction";class d{constructor(t,e,i,s){this.type=t;this.dasmInstruction=e;this.addressCellValue=i;this.instructionCellValue=s;this.annotationCellValue={type:t,dasmInstruction:e,breakpoints:[]}}}const g=(t,e)=>{if(t&&e&&t.length===e.length&&t.length>0){for(let i=0;i<t.length;++i){if(t[i]!==e[i])return false}return true}return false};class u{constructor(t,e){this.dasmView=t;this.console=e;this.rowCount=0;this.dataIsReady=false;this.gridRows=[];this.includeSource=false;this.hasLabels=false;this.viewPortStartRow=0;this.viewPortVisibleRows=0;this.onDisassembly=async(t,e,i)=>{const s=[];t.forEach(((t,i)=>{let o=-1;for(let i=s.length-1;i>=0;--i){const r=s[i].dasmInstruction.labels;const n=e?t.labels:undefined;if(r&&n&&g(r,n)){o=i;break}const a=s[i].dasmInstruction.source;const c=t.source;if(a&&c&&a.line===c.line&&a.path===c.path){o=i;break}}if(o!==-1){s.splice(o+1,0,u.createGridRow(t,e,true)[0])}else{s.push(...u.createGridRow(t,e,false))}}));let o=0;switch(i){case"scrollDown":o=this.getScrollTopRowIndex(s)+1;break;case"scrollUp":o=this.getScrollTopRowIndex(s)-1;break;case"refresh":o=this.getScrollTopRowIndex(s);break;case"reposition":{o=s.findIndex((t=>t.dasmInstruction.isRequestedLocation));const t=s[o];const e=Number.parseInt(t.dasmInstruction.location.replace("0x",""),16);const i=Number.parseInt(this.gridRows[this.viewPortStartRow].dasmInstruction.location.replace("0x",""),16);const r=Number.parseInt(this.gridRows[this.viewPortStartRow+this.viewPortVisibleRows].dasmInstruction.location.replace("0x",""),16);if(e>i&&e<r){o=this.findMatchingRowIndex(s,this.gridRows[this.viewPortStartRow].dasmInstruction,this.gridRows[this.viewPortStartRow].type)}}break;default:o=s.findIndex((t=>t.dasmInstruction.isRequestedLocation));break}this.gridRows=s;await this.updateBreakpoints();this.dataIsReady=true;return o}}clearGridRows(){this.gridRows=[]}async disassemble(t,e,i,s){this.console.debug(`Requesting disassemble at ${t}, reason is ${s}`);if(this.targetAdapter&&t){this.includeSource=e;this.hasLabels=i;const o=this.viewPortVisibleRows*2;this.rowCount=o*2;const r=await this.targetAdapter.disassemble(e,t,o,o);return this.onDisassembly(r,i,s)}else{this.includeSource=false;this.hasLabels=false;this.gridRows=[];this.dataIsReady=true;this.dasmView.el.dispatchEvent(new CustomEvent("dasm-data-changed"))}}async onViewportChanged(t,e,i){this.console.debug(`Viewport changed startRow=${t}, visibleRows=${e}, reason=${i}`);this.viewPortStartRow=t;this.viewPortVisibleRows=e;if(i==="onScroll"||i==="resize"){if(t+e>=this.rowCount-1){const t=this.gridRows[this.viewPortStartRow]?.dasmInstruction.location;if(t&&parseInt(t.replace("0x",""),16)<4294967295){this.console.debug((()=>"Requesting next disassembly block"));return this.disassemble(t,this.includeSource,this.hasLabels,"scrollDown")}}else if(t<=0){const t=this.gridRows[0]?.dasmInstruction.location;if(t&&parseInt(t.replace("0x",""),16)>0){this.console.debug((()=>"Requesting previous disassembly block"));return this.disassemble(t,this.includeSource,this.hasLabels,"scrollUp")}}}return 0}async updateBreakpoints(){const t=await(this.targetAdapter?.getBreakpoints());if(!t)return;for(const e of this.gridRows){const i=t.find((t=>{if(t.type===e.annotationCellValue.type){switch(t.type){case"source":{let i,s,o,r;if(e.dasmInstruction.source){i=e.dasmInstruction.source.line;s=e.dasmInstruction.source.path}if(t.source){o=t.source.line;r=t.source.path}return o===i&&r===s?t:undefined}case"address":{return t.location===e.dasmInstruction.location?t:undefined}case"label":{return e.dasmInstruction.labels?.find((e=>e.startsWith(t.label)))}}}}));e.annotationCellValue.breakpoints=i?[i]:[]}}async toggleBreakpoint(t){await this.targetAdapter.toggleBreakpoint(t);await this.updateBreakpoints();this.dasmView.el.dispatchEvent(new CustomEvent("dasm-data-changed"))}getValue(t,e){if(!this.dataIsReady){return e===a?undefined:"..."}return this.gridRows[t]?.[e]}getPartName(t,e,i){const s=this.gridRows[t];let o="dasm-cell";if(e===c){o+="-location"}else if(s.type==="label"){o+="-symbol"}if(i?.selected){o+="-selected"}return o}setValue(){}getRowInfo(t){return this.gridRows[t]}static createAddressRow(t){return new d("address",t,t.addressText,t.instructionText.replace(/\s/g,"&nbsp;"))}static createSourceRow(t){return new d("source",t,`<span class="location-col">line ${t.source?.line.toString()}</span>`,t.source?.content)}static createLabelRow(t){return new d("label",t,"",(t.formattedLabels||t.labels)?.join(", "))}static createGridRow(t,e,i){if(i){return[u.createAddressRow(t)]}else{const i=[];if(t.source){i.push(u.createSourceRow(t))}if(e&&(t.labels||t.formattedLabels)?.length>0){i.push(u.createLabelRow(t))}i.push(u.createAddressRow(t));return i}}getScrollTopRowIndex(t){return this.gridRows?.length>0?this.findMatchingRowIndex(t,this.gridRows[this.viewPortStartRow].dasmInstruction,this.gridRows[this.viewPortStartRow].type):0}findMatchingRowIndex(t,e,i){for(let s=0;s<t.length;++s){const{dasmInstruction:o,type:r}=t[s];if(o.location===e.location&&o.labels?.toString()===e.labels?.toString()&&o.source?.path===e.source?.path&&o.source?.line===e.source?.line&&r===i){return s}}return-1}}const m=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}:host{height:400px;width:600px;margin:0;border:2px solid var(--gc-border-color, var(--theme-border-color, #e5e5e5))}:host gc-widget-grid{border:none;flex:1;overflow:hidden;--gc-font-color-highlighted:$gc-font-color;--gc-background-color-highlighted:transparent;--gc-outline-color-focus:transparent}:host gc-widget-grid::part(annotation-cell){background-color:var(--gc-annotation-background-color, #eeeeee);width:24px;height:100%;padding:0;position:relative;display:flex;align-items:center;justify-content:center}:host gc-widget-grid::part(annotation-pc){position:absolute;margin:0;--gc-color:var(--gc-annotation-pc-color, #f3cd34)}:host gc-widget-grid::part(annotation-bp){position:absolute;margin:0;--gc-color:var(--gc-annotation-bp-color, #dd0000)}:host gc-widget-grid::part(annotation-bp-disabled){position:absolute;margin:0;--gc-color:var(--gc-annotation-bp-color-disabled, #98999b)}:host gc-widget-grid::part(dasm-cell){color:var(--gc-font-color)}:host gc-widget-grid::part(dasm-cell-location){color:var(--gc-location-font-color)}:host gc-widget-grid::part(dasm-cell-symbol){color:var(--gc-symbol-font-color)}:host gc-widget-grid::part(dasm-cell-location-selected){color:var(--gc-location-font-color-selected-inactive)}:host gc-widget-grid::part(dasm-cell-symbol-selected){color:var(--gc-symbol-font-color-selected-inactive)}:host gc-widget-grid::part(dasm-cell-selected){color:var(--gc-font-color-selected-inactive)}:host gc-widget-grid #text-col{--gc-column-width:1fr;min-width:300px}:host gc-widget-grid:focus-within::part(dasm-cell-location-selected){color:var(--gc-location-font-color-selected)}:host gc-widget-grid:focus-within::part(dasm-cell-symbol-selected){color:var(--gc-symbol-font-color-selected)}:host gc-widget-grid:focus-within::part(dasm-cell-selected){color:var(--gc-font-color-selected)}:host .no-margin{margin:0}:host>*{width:100%}:host #root-container{display:flex;flex-direction:column;height:100%}:host #root-container #top-bar{display:flex;flex-direction:row;align-items:center;justify-content:flex-end;background-color:var(--gc-background-color, #eeeeee);height:var(--gc-height);padding:3px 0 3px 0}:host #root-container #top-bar gc-widget-select{height:100%}:host #root-container #top-bar gc-widget-label{margin:0 5px 0 5px}:host #root-container #top-bar gc-widget-toolbar{width:auto;margin:0 5px}:host #root-container #top-bar gc-widget-toolbar gc-widget-toolbar-action{margin:0;padding:0 2px 0 2px}';const f=new o("gc-widget-disassembly-view");let p=0;let b=class{constructor(i){t(this,i);this.cssPropertyChanged=e(this,"css-property-changed",7);this.dasmViewportStartRow=-1;this.viewId=p++;this.collapsed=true;this.cachedLocation=undefined;this.cachedRequest=undefined;this.addresses=[];this.addressBarDisabled=true;this.mixedMode=false;this.showSymbols=true;this.toolbarActionIconSize="m";this.contextMenuActionIconSize="m";this.onDasmDataChanged=()=>{this.dasmGridEl.refresh()};this.onGridViewportChanged=async({detail:t})=>{const{startRow:e,visibleRows:i,reason:s}=t;if(i===0){this.collapsed=true;return}else{this.collapsed=false}this.dasmViewportStartRow=e;const o=await(this.dataProvider?.onViewportChanged(e,i,s));if(o!==0){await this.dasmGridEl.setDataProvider(this.dataProvider);this.dasmGridEl.selectedRow-=e;this.dasmGridEl.scrollRowsBy(o)}};this.onGridRendered=async()=>{if(!this.collapsed&&this.cachedLocation&&this.cachedRequest){await this.gotoLocation(this.cachedLocation,this.cachedRequest);this.cachedLocation=undefined;this.cachedRequest=undefined}};this.onAnnotationClick=({detail:t})=>{const e={type:t.type,location:t.dasmInstruction.location};const i=t.dasmInstruction;e.label=i.labels?.length>0?i.labels?.[0].replace("()",""):"";e.source=i.source?{line:i.source?.line,path:i.source.path}:undefined;e.location=i.location;this.dataProvider?.toggleBreakpoint(e)};this.onAddressHdlr=t=>{const e=t.detail.value?.trim();if(e&&e.length>0){const t=this.addresses.indexOf(e);if(t<0){const t=[e,...this.addresses];if(t.length>10){t.splice(t.length-1,1)}this.addresses=t}if(e===this.selectedAddress){this.onSelectedAddressChanged(e)}else{this.selectedAddress=e}this.currentLocation=e}};this._refresh=0;this.hidden=false}render(){return[i("div",{id:"root-container"},i("div",{id:"top-bar",part:"top-bar"},i("gc-widget-select",{part:"location",ref:t=>this.addressEl=t,disabled:this.addressBarDisabled,type:"filter",class:"no-margin",autoOpen:true,placeholder:"Enter location here...",labels:this.addresses.join(","),selectedLabel:this.selectedAddress,"onFilter-text-committed":this.onAddressHdlr}),i("gc-widget-toolbar",{part:"toolbar"},i("gc-widget-toolbar-separator",{part:"toolbar-separator"}),i("gc-widget-toolbar-action",{part:"toolbar-action refresh",actionId:`dasm-refresh-${this.viewId}`,iconSize:this.toolbarActionIconSize,iconFolderPath:this.actionRefreshIcon?this.actionIconFolderPath:undefined,icon:this.actionRefreshIcon||"navigation:refresh",tooltip:"Refresh view"}),i("gc-widget-toolbar-action",{part:"toolbar-action goto-pc",actionId:`dasm-goto-pc-${this.viewId}`,iconSize:this.toolbarActionIconSize,iconFolderPath:this.actionGotoPcIcon?this.actionIconFolderPath:undefined,icon:this.actionGotoPcIcon||"content:low_priority",tooltip:"Goto current PC location"}),i("gc-widget-toolbar-separator",{part:"toolbar-separator"}),i("gc-widget-toolbar-action",{part:"toolbar-action step-over",actionId:`dasm-step-over-${this.viewId}`,iconSize:this.toolbarActionIconSize,iconFolderPath:this.actionStepOverIcon?this.actionIconFolderPath:undefined,icon:this.actionStepOverIcon||"content:redo",tooltip:"Assembly Step Over"}),i("gc-widget-toolbar-action",{part:"toolbar-action step-in",actionId:`dasm-step-in-${this.viewId}`,iconSize:this.toolbarActionIconSize,iconFolderPath:this.actionStepInIcon?this.actionIconFolderPath:undefined,icon:this.actionStepInIcon||"navigation:arrow_downward",tooltip:"Assembly Step Into"}))),i("gc-widget-grid",{part:"grid",id:"dasm-grid",class:"no-margin",multiSelectEnable:true,virtual:true,hideHeading:true,ref:t=>this.dasmGridEl=t,"onViewport-changed":this.onGridViewportChanged,onRendered:this.onGridRendered},i("gc-widget-disassembly-view-annotation-column",{name:`${a}`,heading:"Annotation","onAnnotation-click":this.onAnnotationClick}),i("gc-widget-grid-data-column",{id:"address-col",heading:"Address",hideMinimizeAction:true,readonly:true,name:`${c}`}),i("gc-widget-grid-data-column",{id:"text-col",heading:"Text",hideMinimizeAction:true,readonly:true,name:`${h}`}))),i("gc-widget-context-menu",{part:"contextmenu",anchorId:"dasm-grid"},i("gc-widget-menuaction",{part:"contextmenu-action copy-selection","action-id":`dasm-copy-selection-${this.viewId}`,iconSize:this.contextMenuActionIconSize,iconFolderPath:this.actionSymbolsIcon?this.actionIconFolderPath:undefined,icon:this.actionSymbolsIcon||"content:content_copy",label:"Copy"}),i("gc-widget-menuseparator",{part:"contextmenu-separator"}),i("gc-widget-menuaction",{part:"contextmenu-action resume-at-line","action-id":`dasm-resume-at-line-${this.viewId}`,iconSize:this.contextMenuActionIconSize,iconFolderPath:this.actionResumeAtLineIcon?this.actionIconFolderPath:undefined,icon:this.actionResumeAtLineIcon||"av:play_arrow",label:"Resume at line"}),i("gc-widget-menuaction",{part:"contextmenu-action run-to-line","action-id":`dasm-run-to-line-${this.viewId}`,iconSize:this.contextMenuActionIconSize,iconFolderPath:this.actionRunToLineIcon?this.actionIconFolderPath:undefined,icon:this.actionRunToLineIcon||"av:skip_next",label:"Run to line"}),i("gc-widget-menuaction",{part:"contextmenu-action move-to-line","action-id":`dasm-move-to-line-${this.viewId}`,iconSize:this.contextMenuActionIconSize,iconFolderPath:this.actionMoveToLineIcon?this.actionIconFolderPath:undefined,icon:this.actionMoveToLineIcon||"editor:wrap_text",label:"Move to line"}),i("gc-widget-menuseparator",{part:"contextmenu-separator"}),i("gc-widget-menuaction",{part:"contextmenu-action show-source","action-id":`dasm-show-source-${this.viewId}`,iconSize:this.contextMenuActionIconSize,iconFolderPath:this.actionSourceIcon?this.actionIconFolderPath:undefined,icon:this.actionSourceIcon||"action:code",label:"Show source"}),i("gc-widget-menuaction",{part:"contextmenu-action show-symbols","action-id":`dasm-show-symbols-${this.viewId}`,iconSize:this.contextMenuActionIconSize,iconFolderPath:this.actionSymbolsIcon?this.actionIconFolderPath:undefined,icon:this.actionSymbolsIcon||"content:tag",label:"Show symbols"}))]}componentWillLoad(){this.dataProvider=new u(this,f);this.el.addEventListener("dasm-data-changed",this.onDasmDataChanged)}componentDidLoad(){this.el.addEventListener("contextmenu",(t=>t.preventDefault()))}connectedCallback(){this.registerActions()}disconnectedCallback(){this.unregisterActions()}componentDidRender(){this.addressEl.setFilterFunction((t=>t));if(this.sourceStylesheet){const t=this.dasmGridEl?.shadowRoot;if(!t.querySelector("style[is-disassembly-view-style")){t.appendChild(this.sourceStylesheet)}}this.updateActions()}updateActions(){this.addressBarDisabled=!this.hasDebugContext();const t=this.el.shadowRoot.querySelectorAll("gc-widget-toolbar-action");t.forEach((t=>t.updateStates()))}async setTargetAdapter(t){this.dataProvider.targetAdapter=t;await this.gotoLocation(undefined)}async setSourceStylesheet(t){this.sourceStylesheet=document.createElement("style");this.sourceStylesheet.setAttribute("is-disassembly-view-style","");this.sourceStylesheet.innerHTML=t}async gotoLocation(t,e="reload"){if(this.collapsed){this.cachedLocation=t;this.cachedRequest=e;return}this.currentLocation=t?.toString();try{if(this.dasmGridEl){if(t?.length>0){const i=await this.dataProvider.disassemble(t,this.mixedMode,this.showSymbols,e);await this.dasmGridEl.setDataProvider(this.dataProvider);await this.dasmGridEl.scrollRowsBy(i)}else{this.dataProvider.clearGridRows();await this.dasmGridEl.setDataProvider(n)}}}catch(t){f.error(t)}this.updateActions()}async breakpointChanged(){await this.dataProvider.updateBreakpoints();await(this.dasmGridEl?.refresh())}async getSelectedRowText(){return this.dasmGridEl?.getSelectedRowText()}reload(){return this.gotoLocation(this.currentLocation)}async onSelectedAddressChanged(t){let e=t;try{e="0x"+parseInt(t).toString(16)}catch{}f.debug(`address changed to ${e}`);this.gotoLocation(t)}hasDebugContext(){return this.currentLocation&&!!this.dataProvider.targetAdapter}unregisterActions(){r.unregisterAction(`dasm-refresh-${this.viewId}`);r.unregisterAction(`dasm-goto-pc-${this.viewId}`);r.unregisterAction(`dasm-step-in-${this.viewId}`);r.unregisterAction(`dasm-step-over-${this.viewId}`);r.unregisterAction(`dasm-run-to-line-${this.viewId}`);r.unregisterAction(`dasm-move-to-line-${this.viewId}`);r.unregisterAction(`dasm-resume-at-line-${this.viewId}`);r.unregisterAction(`dasm-show-source-${this.viewId}`);r.unregisterAction(`dasm-show-symbols-${this.viewId}`);r.unregisterAction(`dasm-copy-selection-${this.viewId}`)}registerActions(){r.registerAction(`dasm-refresh-${this.viewId}`,{run:async()=>{f.debug("Refresh");await(this.dataProvider.targetAdapter?.refresh());const t=this.dataProvider.getRowInfo(this.dasmViewportStartRow).dasmInstruction.location;return this.gotoLocation(t,"refresh")},isEnabled:()=>this.hasDebugContext()});r.registerAction(`dasm-goto-pc-${this.viewId}`,{run:async()=>{const t=await(this.dataProvider.targetAdapter?.getPcLocation());f.debug(`Goto PC at ${t}`);this.gotoLocation(t)},isEnabled:()=>this.hasDebugContext()});r.registerAction(`dasm-step-in-${this.viewId}`,{run:async()=>{f.debug("Assembly step in");await(this.dataProvider.targetAdapter?.asmStepIn())},isEnabled:()=>this.hasDebugContext()});r.registerAction(`dasm-step-over-${this.viewId}`,{run:async()=>{f.debug("Assembly step over");await(this.dataProvider.targetAdapter?.asmStepOver())},isEnabled:()=>this.hasDebugContext()});r.registerAction(`dasm-run-to-line-${this.viewId}`,{run:()=>{const{location:t,addressText:e}=this.dataProvider.getValue(this.dasmGridEl?.selectedRow,l);f.debug(`Run to line at 0x${e}`);this.dataProvider.targetAdapter?.runToLine(t)},isEnabled:()=>this.hasDebugContext()});r.registerAction(`dasm-move-to-line-${this.viewId}`,{run:()=>{const{location:t,addressText:e}=this.dataProvider.getValue(this.dasmGridEl?.selectedRow,l);f.debug(`Move to line at 0x${e}`);this.dataProvider.targetAdapter?.moveToLine(t)},isEnabled:()=>this.hasDebugContext()});r.registerAction(`dasm-resume-at-line-${this.viewId}`,{run:()=>{const{location:t,addressText:e}=this.dataProvider.getValue(this.dasmGridEl?.selectedRow,l);f.debug(`Resume at line at 0x${e}`);this.dataProvider.targetAdapter?.resumeAtLine(t)},isEnabled:()=>this.hasDebugContext()});r.registerAction(`dasm-show-source-${this.viewId}`,{run:()=>{f.debug(`Switch mixed mode to ${!this.mixedMode?"on":"off"}`);this.mixedMode=!this.mixedMode;this.reload()},isChecked:()=>this.mixedMode});r.registerAction(`dasm-show-symbols-${this.viewId}`,{run:()=>{f.debug(`Show symbols set to ${!this.showSymbols?"on":"off"}`);this.showSymbols=!this.showSymbols;this.reload()},isChecked:()=>this.showSymbols});r.registerAction(`dasm-copy-selection-${this.viewId}`,{run:async()=>{f.debug("Copy selected row");const t=await this.getSelectedRowText();navigator.clipboard.writeText(t)},isEnabled:()=>this.hasDebugContext()})}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return s(this)}static get watchers(){return{selectedAddress:["onSelectedAddressChanged"]}}};b.style=m;const w="";class v{constructor(t,e,i){this.dasmAnnotationColumn=t;this.callback=e;this.clickEvent=i}renderCell(t,e,s,o,r){const n=e.getValue(a);const c=i("div",{part:"annotation-cell",onClick:t=>this.onClickHandler(t,n)},this.renderPC(n),this.renderBreakpoint(n));return{element:c,focusable:false}}renderPC(t){const e=t?.dasmInstruction?.hasPC;if(e){if(t.dasmInstruction.customPCIcon){return i("div",{class:t.dasmInstruction.customPCIcon.class,style:t.dasmInstruction.customPCIcon.style})}else{return i("gc-widget-icon",{icon:"ti:top_stack_frame",size:"s",appearance:"custom",part:"annotation-pc"})}}else{return undefined}}renderBreakpoint(t){const e=t?.breakpoints?t.breakpoints.length>0:false;if(e){const s=t.breakpoints[0];const o=e&&!!s.enabled;const r=t.dasmInstruction.hasPC;if(s.customIcon){const e=s.customIcon.style;if(t.dasmInstruction?.hasPC){e.fontSize="10px"}return i("div",{class:s.customIcon.class,style:e})}else{return e?i("gc-widget-icon",{icon:"filled:ti:breakpoint",size:r?"xs":"s",appearance:"custom",part:`annotation-bp${!o?"-disabled":""}`}):undefined}}else{return undefined}}onClickHandler(t,e){t.preventDefault();t.stopPropagation();this.clickEvent.emit(e)}}let x=class{constructor(i){t(this,i);this.annotationClickEvent=e(this,"annotation-click",7);this.minimizedChanged=e(this,"minimized-changed",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.hideMinimizeAction=false;this.minimized=false;this._refresh=0;this.hidden=false}async createCellRenderer(t){return new v(this,t,this.annotationClickEvent)}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return s(this)}};x.style=w;const y=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}gc-widget-grid-tree-column{--gc-column-width:1fr;--gc-heading-text-align:start}gc-widget-grid-data-column{--gc-text-align:start;--gc-heading-text-align:start}:host{border:2px solid var(--gc-border-color, var(--gc-border-color, var(--theme-border-color, #e5e5e5)))}#grid{width:100%;height:100%;margin:0px;border:none}#grid::part(open){font-style:italic}#grid::part(branch){font-weight:500;font-size:93%}#grid::part(leaf){font-size:86%}#grid::part(focused){outline:1px dotted var(--gc-outline-color-focus, var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555))));outline-offset:-3px}#grid::part(register-dirty){color:var(--gc-color-dirty, var(--theme-primary-color, #cc0000))}#grid::part(register-dirty):focus{color:inherit}';const k=25;const $="CSTYLEHEX";class z{constructor(t,e){this.data=t;this.total=e;this.requested=t.length}get available(){return this.data.length}appendMoreData(t,e){this.data=this.data.concat(t);this.total=e}}const S=new class{constructor(){this.rowCount=0}setValue(){}getValue(){return undefined}};class R{constructor(t,e,i){this.parentDataProvider=t;this.bitfieldInfo=e;this.bitfieldValues=i}get rowCount(){return this.bitfieldInfo.length}getValue(t,e){if(e==="value"){const e=this.bitfieldValues.bitfieldValues[t];const i=this.bitfieldInfo[t].bitfieldEnums?.bitfieldEnums.find((t=>t.token===e))?.value;return this.getDisplayValue(i,e)}else{return this.bitfieldInfo[t][e]}}setValue(t,e,i){const s=this.bitfieldInfo[t].id;const o=typeof i==="string"?i.split(" - ")[0]:i.toString();this.parentDataProvider.context.writeBitfield(s,o).then((()=>{this.parentDataProvider.grid.setFocus();this.parentDataProvider.refreshAllRegisterValues()}),(()=>{this.parentDataProvider.grid.setFocus()}))}isReadonly(t){const e=this.bitfieldInfo[t];return e.readable&&!e.writable}isWriteOnly(t){const e=this.bitfieldInfo[t];return e.writable&&!e.readable}lookupRowByName(t){return this.bitfieldInfo.findIndex((e=>e.name===t))}updateValues(t){this.bitfieldValues=t}getBitfieldEnums(t){return this.bitfieldInfo[t].bitfieldEnums?.bitfieldEnums}getDisplayValue(t,e){return typeof t!=="undefined"?`${t} - ${e}`:e}}class C{constructor(t,e,i,s){this.groupId=t;this.parent=s;let o=e.registers;if(e.numBitfields){o=e.registers.map(((t,i)=>{const s=t;s.bitfieldCount=e.numBitfields[i];return s}))}this.registers=new z(o,e.total);this.subgroups=new z(i.groups,i.total)}get rowCount(){return this.registers.total+this.subgroups.total}setVisibility(t,e){if(t<this.registers.available){const i=this.registers.data[t];if(e&&i.visible!==true){this.parent.doReadValue(i)}i.visible=e}}getValue(t,e){if(t<this.registers.total){this.setVisibility(t,true);if(t<this.registers.available){return this.registers.data[t][e]}if(t>=this.registers.requested){const e=Math.max(t-this.registers.requested,k);this.parent.context.getRegisters(e,this.registers.requested,this.groupId).then((async t=>{const e=await Promise.all(t.registers.map((async t=>{const e=await this.parent.context.getBitfields(t.id);return{...t,bitfieldCount:e.bitfields.length}})));this.registers.appendMoreData(e,t.total);this.parent.redraw()}));this.registers.requested+=e}}else{t-=this.registers.total;if(t<this.subgroups.available){return this.subgroups.data[t][e]}if(t>=this.subgroups.requested){const e=Math.max(t-this.subgroups.requested,k);this.parent.context.getGroups(e,this.subgroups.requested,this.groupId).then((t=>{this.subgroups.appendMoreData(t.groups,t.total);this.parent.redraw()})).catch((t=>{o.error("DsLiteRegisterDataProvider",t.message||t.toString())})).finally((()=>{o.log("DsLiteRegisterDataProvider","fetched more groups")}));this.subgroups.requested+=e}}return e==="name"?"...":undefined}setValue(t,e,i){if(t<this.registers.available){this.parent.doWriteValue(this.registers.data[t],i)}}isReadonly(t){if(t<this.registers.available){const e=this.registers.data[t];return e.readable&&!e.writable}return true}isWriteOnly(t){if(t<this.registers.available){const e=this.registers.data[t];return e.writable&&!e.readable}return false}lookupRowByName(t){let e=this.registers.data.findIndex((e=>e.name===t));if(e<0){e=this.subgroups.data.findIndex((e=>e.name===t))}return e}isExpandable(t){let e=0;if(t<this.registers.available&&this.registers.data[t].bitfieldCount){e=this.registers.data[t].bitfieldCount}return t>=this.registers.total&&t-this.registers.total<this.subgroups.available||e>0}getChildDataProvider(t){const e=this.subgroups.data[t-this.registers.total];if(e){if(!e.provider){e.provider=(async()=>{const t=this.parent.context.getGroups(k,0,e.id);const i=await this.parent.context.getRegisters(k,0,e.id);const s=await Promise.all(i.registers.map((async t=>(await this.parent.context.getBitfields(t.id)).bitfields.length)));return new C(e.id,{...i,numBitfields:s},await t,this.parent)})()}return e.provider}const i=this.registers.data[t];if(i){if(!i.provider){i.provider=(async()=>{const t=await this.parent.context.getBitfields(i.id);const e=await this.parent.context.readWithBitfields(i.id,this.parent.format);const s=await Promise.all(t.bitfields.map((async t=>{const e=await this.parent.context.getBitfieldEnums(t.id);return{...t,bitfieldEnums:e}})));return new R(this.parent,s,e)})()}return i.provider}return S}getPartName(t,e,i){if(e==="value"){const e=this.registers.data[t];if(e&&"dirty"in e&&e.dirty){return"register-dirty"}}return""}}class P extends C{constructor(t,e,i){super(undefined,{registers:[],total:0},e,undefined);this.context=t;this.grid=i;this.registerReadCache=new Set;this.parent=this;this.format=$}static async create(t,e){return new P(t,await t.getGroups(k,0),e)}async doReadValue(t,e=false){if(t.stale===false){return}this.registerReadCache.add(t);t.stale=false;const i=await this.context.read(t.id,this.format);if(t.value!==i.value){if(!e&&t.value!==undefined){t.dirty=true}const s=await this.context.readWithBitfields(t.id,this.format);await(t.provider?.then((t=>t.updateValues(s))));t.value=i.value;this.grid.redrawGrid()}else if(t.dirty===true){t.dirty=false;this.grid.redrawGrid()}if(t.location!==i.location&&!i.location.includes("register")){t.location=i.location;this.grid.redrawGrid()}}async doWriteValue(t,e){try{const i=this.context.write(t.id,e);t.stale=true;const s=this.doReadValue(t);await i;await s}catch(t){o.error("DsLiteRegisterDataProvider",t.message||t.toString())}}refreshAllRegisterValues(t=false){const e=this.registerReadCache;this.registerReadCache=new Set;e.forEach((e=>{e.stale=true;if(e.visible){this.doReadValue(e,t)}}))}setFormat(t){if(t){this.format=t}else{this.format=$}this.refreshAllRegisterValues(true)}async clearDirtyRegisters(){for(const t of this.registerReadCache){t.dirty=false}}redraw(){this.grid.redrawGrid()}}let A=class{constructor(i){t(this,i);this.cssPropertyChanged=e(this,"css-property-changed",7);this.fontSize=A.REFERENCE_FONT_SIZE;this.debugCores=new Map;this.hideLocationColumn=false;this.hideHeading=false;this.onCSSPropertyChanged=()=>{this.redrawGrid()};this.onSelectedPathChanged=async t=>{const e=t.detail.value;this.options=await this.getBitfieldEnumsAsOptions(e)};this._refresh=0;this.hidden=false;this.readonly=false}componentWillRender(){const t=Number.parseFloat(getComputedStyle(this.el).getPropertyValue("font-size"));if(!isNaN(t)){this.fontSize=t}}render(){const t=Math.ceil((16+2)*10*this.fontSize/A.REFERENCE_FONT_SIZE);return i("gc-widget-grid",{id:"grid",part:"grid",ref:t=>this.grid=t,virtual:true,filterText:this.filterText,readonly:this.readonly,hideHeading:this.hideHeading},i("gc-widget-grid-tree-column",{heading:"Register",hideMinimizeAction:true},i("slot",null)),i("gc-widget-grid-data-column",{key:"value",heading:"Value",name:"value",format:"text",hideMinimizeAction:true,style:{"--gc-column-width":`${t}px`},options:this.options}),this.hideLocationColumn?null:i("gc-widget-grid-data-column",{key:"address",heading:"Location",name:"location",readonly:true,format:"text"}),i("gc-widget-grid-data-column",{key:"description",heading:"Description",name:"description",format:"text",readonly:true,minimized:true}))}async setFilterMethod(t){this.grid?.setFilterMethod(t)}async redrawGrid(){this.grid?.refresh()}async setRegisters(t,e="default"){let i=false;if(this.activeCoreName===e){return}this.activeCoreName=e;let s=this.debugCores.get(e);if(!s){s=P.create(t,this);this.debugCores.set(e,s);i=true}const o=await s;if(this.activeCoreName===e&&this.grid){this.grid.setDataProvider(o,0,e);if(i){this.grid.toggleOpen(0)}}}async clear(){this.debugCores.clear();this.activeCoreName=undefined;this.grid.setDataProvider(S)}async update(){for(const[,t]of this.debugCores){const e=await t;e.refreshAllRegisterValues()}}async clearDirtyRegisters(){for(const[,t]of this.debugCores){const e=await t;e.clearDirtyRegisters()}}async setFormat(t){this.debugCores.forEach((async e=>{const i=await e;i.setFormat(t)}))}async setFocus(){this.grid.setFocus()}connectedCallback(){this.el.addEventListener("css-property-changed",this.onCSSPropertyChanged);this.el.addEventListener("selected-path-changed",this.onSelectedPathChanged)}disconnectedCallBack(){this.el.removeEventListener("css-property-changed",this.onCSSPropertyChanged);this.el.removeEventListener("selected-path-changed",this.onSelectedPathChanged)}async getBitfieldEnumsAsOptions(t){let e=undefined;if(this.activeCoreName){let i=await this.debugCores.get(this.activeCoreName);if(i){const s=t.split("/");let o=0;let r=-1;while(i&&o<s.length-1){r=i.lookupRowByName(s[o]);const t=await i.getChildDataProvider(r);if(t instanceof R){const i=t.lookupRowByName(s[o+1]);e=t.getBitfieldEnums(i)?.map((e=>t.getDisplayValue(e.value,e.token))).join(",");break}else{i=t}o+=1}}}return e}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return s(this)}};A.REFERENCE_FONT_SIZE=14;A.style=y;export{b as gc_widget_disassembly_view,x as gc_widget_disassembly_view_annotation_column,A as gc_widget_xds_register_view};
//# sourceMappingURL=p-8248ebba.entry.js.map