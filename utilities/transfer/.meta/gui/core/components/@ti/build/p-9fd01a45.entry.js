import{r as t,c as e,h as o,H as i,g as r}from"./p-823ca21f.js";import{GcUtils as n}from"../gc-core-assets/lib/GcUtils";import{GcConsole as c}from"../gc-core-assets/lib/GcConsole";import{GcMessageDialog as a}from"../gc-widget-message-dialog/lib/GcMessageDialog";const s=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}:host .separator{color:var(--theme-menu-color, #f7f7f7)}:host gc-widget-icon{margin:0;--gc-color:var(--theme-menu-color, #f7f7f7)}:host gc-widget-label{white-space:nowrap;--gc-color:var(--theme-menu-color, #f7f7f7);--gc-text-align:center;--gc-font-weight:400}:host gc-widget-label.clickable{--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}';const l=new c("gc-widget-authentication");let h=class{constructor(o){t(this,o);this.loginEvent=e(this,"login",7);this.logoutEvent=e(this,"logout",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.doLogin=()=>{l.logAPI(this.doLogin.name);location.href="/login?redirect="+location.toString()};this.doLogout=()=>{l.logAPI(this.doLogout.name);const t=new XMLHttpRequest;t.open("GET","/logout?reason=click",true);t.send()};this.addListeners=()=>{if(typeof window.io!=="undefined"&&!n.isInDesigner){this.socket=window.io.connect(location.origin);this.socket.on("login",(()=>{this.loginEvent.emit();if(this.loginPageReload){location.reload()}else{this.updateStatus()}}));this.socket.on("logout",(()=>{this.authenticated=false;this.logoutEvent.emit();if(!this.disableLogoutPrompt){setTimeout((()=>{a.prompt("Authentication",`You have been logged out from ${document.title}. Press OK to continue with your session.`,"action:verified_user",false).then((t=>{if(t==="confirm"){this.doLogin()}}))}),250)}}));this.socket.on("asklogout",(t=>{const e=this.el.shadowRoot.querySelector("#auth_frame");if(e){e.src=`/logout?reason=${t.reason}&redirect=/emptypage`}}));this.socket.on("preparelogout",(t=>{this.socket.emit("logoutready")}))}};this.updateStatus=async()=>new Promise((t=>{const e=new XMLHttpRequest;e.open("GET","/api/queryUserStatus",true);e.onreadystatechange=()=>{if(e.readyState===4&&e.status===200){try{const{firstname:t,lastname:o,uid:i}=JSON.parse(e.responseText);const r=t||i;this.authenticated=!!i;this.displayName=r?r.toString():undefined;this.tooltip=this.authenticated?`Hello ${t} ${o}`:"Click to login or register"}catch{this.authenticated=false}t()}};e.send()}));this._refresh=0;this.hidden=false;if(n.isCloud){if(typeof window.io==="undefined"){const t=document.createElement("script");t.onload=this.addListeners;t.src="/socket.io/socket.io.js";document.head.appendChild(t);const e=document.createElement("script");e.src="/login/index.js";document.head.appendChild(e)}else{this.addListeners()}}}componentDidLoad(){this.updateStatus()}render(){if(n.isInDesigner){return undefined}else{return o(i,{"data-di-mask":true},this.authenticated?o("span",{style:{display:"flex","align-items":"center"}},o("gc-widget-icon",{icon:"action:account_circle",appearance:"custom",tooltip:this.tooltip}),o("gc-widget-label",{label:this.displayName,tooltip:this.tooltip}),o("div",{class:"separator"},"|"),o("gc-widget-label",{class:"clickable",label:"Logout","on-click":this.doLogout})):o("gc-widget-label",{class:"clickable",label:"Login | Register","on-click":this.doLogin}),o("iframe",{id:"auth_frame",hidden:true}))}}async login(){return this.doLogin()}async logout(){return this.doLogout()}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return r(this)}};h.style=s;export{h as gc_widget_authentication};
//# sourceMappingURL=p-9fd01a45.entry.js.map